<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" xmlns:b="http://bootsfaces.net/ui">

<h:head>
	<title>Creación y administración de rutas</title>
</h:head>

<h:body>
	<b:container layout="fluid">
		<p:growl id="msgs" showDetail="true" />

		<b:form id="listForm" horizontal="true">
			<h:panelGroup id="listFormGroup"
				rendered="#{!(rutasBacking.edit || rutasBacking.asign )}">

				<b:panel title="CREACIÓN Y ADMINISTRACIÓN DE RUTA" look="primary"
					title-style="text-align:center">

					<h:panelGroup id="headerGroup">
						<b:row>
							<b:column offset="6" span="6">
								<b:commandButton value="Agregar" icon="plus" ajax="true"
									action="#{rutasBacking.add}" update=" @form :editForm "
									process="@this" />
								<b:commandButton value="Editar" icon="edit" ajax="true"
									action="#{rutasBacking.edit(rutasBacking.selected.ruta.id, rutasBacking.selected.ruta.version)}"
									update=" @form :editForm " process="@this"
									disabled="#{not rutasBacking.editable}" />
								<b:commandButton value="Asignar" icon="edit" ajax="true"
									action="#{rutasBacking.asign(rutasBacking.selected)}"
									update=" @form :asignForm " process="@this"
									disabled="#{not rutasBacking.editable}" />
								<b:commandButton value="Eliminar" icon="trash" ajax="true"
									action="#{rutasBacking.delete(rutasBacking.selected.ruta.id, rutasBacking.selected.ruta.version)}"
									update=" listForm msgs " process="@this"
									disabled="#{not rutasBacking.deletable}" />

								<b:commandButton value="Cancelar" ajax="true"
									action="#{rutasBacking.back}" update=" @none " process="@this" />
							</b:column>
						</b:row>
					</h:panelGroup>
					<h:panelGroup id="bodyGroup">
						<b:dataTable value="#{rutasBacking.data}" var="item"
							responsive="true"
							custom-lang-url="//cdn.datatables.net/plug-ins/1.10.12/i18n/Spanish.json"
							paginated="false" select="true" selection-mode="single"
							searching="false" onselect="ajax:rutasBacking.onRowSelect(item)"
							ondeselect="ajax:rutasBacking.onRowDeselect(item)"
							update=" headerGroup footerGroup ">

							<b:dataTableColumn value="#{item.ruta.codigo}" order="asc"
								label="Código" />
							<b:dataTableColumn value="#{item.ruta.descripcion}"
								label="Descripción" />
							<b:dataTableColumn value="#{item.ruta.conductorNombres}"
								label="Conductor" />
							<b:dataTableColumn value="#{item.nombreMonitor}" label="Monitor" />
							<b:dataTableColumn value="#{item.ruta.capacidadMaxima}"
								label="Capacidad máxima" />
							<b:dataTableColumn value="#{item.inscritos}" label="Inscritos" />
<!-- 							
							<b:dataTableColumn label="Opciones" style="display: none;">
								<b:commandButton value="Asignar" icon="edit" ajax="true"
									update=" @form asignForm "
									onclick="ajax:rutasBacking.asign(item)">
								</b:commandButton>
							</b:dataTableColumn>
 -->
						</b:dataTable>
					</h:panelGroup>
					<h:panelGroup id="footerGroup">
						<b:row>
							<b:column offset="6" span="6">
								<b:commandButton value="Agregar" icon="plus" ajax="true"
									action="#{rutasBacking.add}" update=" @form :editForm "
									process="@this" />
								<b:commandButton value="Editar" icon="edit" ajax="true"
									action="#{rutasBacking.edit(rutasBacking.selected.ruta.id, rutasBacking.selected.ruta.version)}"
									update=" @form :editForm " process="@this"
									disabled="#{not rutasBacking.editable}" />
								<b:commandButton value="Asignar" icon="edit" ajax="true"
									action="#{rutasBacking.asign(rutasBacking.selected)}"
									update=" @form :asignForm " process="@this"
									disabled="#{not rutasBacking.editable}" />
								<b:commandButton value="Eliminar" icon="trash" ajax="true"
									action="#{rutasBacking.delete(rutasBacking.selected.ruta.id, rutasBacking.selected.ruta.version)}"
									update=" listForm msgs " process="@this"
									disabled="#{not rutasBacking.deletable}" />

								<b:commandButton value="Cancelar" ajax="true"
									action="#{rutasBacking.back}" update=" @none " process="@this" />
							</b:column>
						</b:row>
					</h:panelGroup>
				</b:panel>

			</h:panelGroup>
		</b:form>

		<b:form id="editForm" horizontal="true">
			<h:panelGroup id="editFormGroup">

				<b:panel title="#{rutasBacking.edicionManager.title}" look="primary"
					offset="2" span="8" rendered="#{rutasBacking.edit}">

					<h:inputHidden value="#{rutasBacking.edicionManager.model.ruta.id}" />

					<b:inputText id="codigo"
						value="#{rutasBacking.edicionManager.model.ruta.codigo}"
						required="true" label="Código" placeholder="Código"
						label-medium-screen="4" medium-screen="8" maxlength="3" mask="999" />
					<b:message for="@previous" />

					<b:inputText
						value="#{rutasBacking.edicionManager.model.ruta.descripcion}"
						required="true" label="Descripción" placeholder="Descripción"
						label-medium-screen="4" medium-screen="8" />
					<b:message for="@previous" />

					<b:inputText
						value="#{rutasBacking.edicionManager.model.ruta.marca}"
						required="true" label="Marca vehículo"
						placeholder="Marca vehículo" label-medium-screen="4"
						medium-screen="8" />
					<b:message for="@previous" />

					<b:inputText
						value="#{rutasBacking.edicionManager.model.ruta.placa}"
						required="true" label="Placa vehículo"
						placeholder="Placa vehículo" label-medium-screen="4"
						medium-screen="8" />
					<b:message for="@previous" />

					<b:inputText
						value="#{rutasBacking.edicionManager.model.ruta.capacidadMaxima}"
						required="true" label="Capacidad máxima"
						placeholder="Capacidad máxima" label-medium-screen="4"
						medium-screen="8" mask="integer" />
					<b:message for="@previous" />

					<b:inputText
						value="#{rutasBacking.edicionManager.model.ruta.conductorNombres}"
						required="true" label="Nombre conductor"
						placeholder="Nombre conductor" label-medium-screen="4"
						medium-screen="8" />
					<b:message for="@previous" />

					<div class="form-group ">
						<span class="col-md-4 control-label"
							style="padding: 6px 15px; font-weight: bold;">Monitor</span>
						<div class="col-md-8">
							<div style="padding: 3px; opacity: 0">-</div>
						</div>
					</div>

					<b:selectOneMenu id="tipoIdentificacionId"
						value="#{rutasBacking.edicionManager.model.tipoIdentificacionId}"
						label="Tipo documento" placeholder="Tipo documento" select2="true"
						label-medium-screen="4" medium-screen="8" ajax="true"
						onchange="ajax:rutasBacking.edicionManager.onChangeIdentificacion()"
						update="nombreMonitorGroup" process="@this numeroIdentificacionId"
						style="width: 80px;">
						<f:selectItem noSelectionOption="true" itemLabel="--" />
						<f:selectItems
							value="#{rutasBacking.edicionManager.listaTipoDocumento}" />
					</b:selectOneMenu>
					<b:message for="@previous" />

					<b:inputText id="numeroIdentificacionId"
						value="#{rutasBacking.edicionManager.model.numeroIdentificacionId}"
						label="Documento" placeholder="Número documento"
						label-medium-screen="4" medium-screen="8" mask="9{1,12}"
						ajax="true"
						onchange="ajax:rutasBacking.edicionManager.onChangeIdentificacion()"
						update="nombreMonitorGroup" process="@this tipoIdentificacionId" />
					<b:message for="@previous" />

					<h:panelGroup id="nombreMonitorGroup">
						<b:row>
							<b:column span="4">
								<div style="padding: 3px; opacity: 0">-</div>
							</b:column>
							<b:column span="8">
								<h:outputText
									value="#{rutasBacking.edicionManager.model.nombreMonitor}"
									style="padding: 6px 12px; font-weight: bold;">
								</h:outputText>
							</b:column>
						</b:row>
					</h:panelGroup>

					<b:inputText
						value="#{rutasBacking.edicionManager.model.ruta.movil}"
						required="true" label="Móvil" placeholder="Móvil"
						label-medium-screen="4" medium-screen="8" mask="9{7,15}" />
					<b:message for="@previous" />

					<div class="form-group ">
						<span class="col-md-4 control-label"
							style="padding: 6px 15px; font-weight: bold;">Dirección
							sede</span>
						<div class="col-md-8">
							<div style="padding: 3px; opacity: 0">-</div>
						</div>
					</div>

					<b:row>
						<b:column span="2" offset="4">
							<b:radiobutton
								value="#{rutasBacking.edicionManager.model.usarDireccionExistente}"
								itemLabel="Nueva" itemValue="false"
								onclick="ajax:rutasBacking.edicionManager.onChangeUsarDireccionExistente()"
								process="@this" update=" direccionGroup "
								style="padding-left: 25px;">
							</b:radiobutton>
						</b:column>
						<b:column span="2">
							<b:radiobutton
								value="#{rutasBacking.edicionManager.model.usarDireccionExistente}"
								itemLabel="Existente" itemValue="true"
								onclick="ajax:rutasBacking.edicionManager.onChangeUsarDireccionExistente()"
								process="@this" update=" direccionGroup "
								style="padding-left: 25px;">
							</b:radiobutton>
						</b:column>
					</b:row>

					<h:panelGroup id="direccionGroup">
						<b:selectOneMenu id="departamentos"
							value="#{rutasBacking.edicionManager.model.departamentoId}"
							label="Departamento" select2="true" label-medium-screen="4"
							medium-screen="8" update="ciudades" process="@this"
							onchange="ajax:rutasBacking.edicionManager.onChangeDepartamento()"
							rendered="#{!rutasBacking.edicionManager.model.usarDireccionExistente}">
							<f:selectItem noSelectionOption="true" itemLabel="--" />
							<f:selectItems
								value="#{rutasBacking.edicionManager.listaDepartamento}" />
						</b:selectOneMenu>
						<b:message for="@previous" />

						<b:selectOneMenu id="ciudades"
							value="#{rutasBacking.edicionManager.model.ciudadId}"
							label="Ciudades" select2="true" label-medium-screen="4"
							medium-screen="8"
							rendered="#{!rutasBacking.edicionManager.model.usarDireccionExistente}">
							<f:selectItem noSelectionOption="true" itemLabel="--" />
							<f:selectItems value="#{rutasBacking.edicionManager.listaCiudad}" />
						</b:selectOneMenu>
						<b:message for="@previous" />

						<b:inputText id="direccion"
							value="#{rutasBacking.edicionManager.model.direccionSede}"
							required="true" label="Dirección" placeholder="Dirección"
							label-medium-screen="4" medium-screen="8"
							rendered="#{!rutasBacking.edicionManager.model.usarDireccionExistente}" />
						<b:message for="@previous" />

						<b:selectOneMenu id="direcciones"
							value="#{rutasBacking.edicionManager.model.ruta.direccionSedeId}"
							label="Dirección" select2="true" label-medium-screen="4"
							medium-screen="8"
							rendered="#{rutasBacking.edicionManager.model.usarDireccionExistente}">
							<f:selectItems
								value="#{rutasBacking.edicionManager.listaDireccion}" />
						</b:selectOneMenu>
					</h:panelGroup>

					<f:facet name="footer">
						<b:commandButton
							value="#{rutasBacking.edicionManager.actionLabel}" icon="disk"
							ajax="true" action="#{rutasBacking.save}"
							update=" @form :listForm msgs" process="@form" look="primary" />

						<b:commandButton value="Cancelar" ajax="true"
							action="#{rutasBacking.cancel}" update=" @form :listForm "
							process="@this" />
					</f:facet>
				</b:panel>

			</h:panelGroup>
		</b:form>

		<b:form id="asignForm" horizontal="true">
			<h:panelGroup id="asignFormGroup">

				<b:panel id="asignPanel" title="Asignación de rutas" look="primary"
					offset="2" span="8" rendered="#{rutasBacking.asign}">

					<b:row>
						<b:column offset="2" span="2">Descripción</b:column>
						<b:column span="6">
							<h:outputText
								value="#{rutasBacking.asignacionManager.model.ruta.descripcion}" />
						</b:column>
					</b:row>
					<b:row>
						<b:column offset="2" span="2">Monitor</b:column>
						<b:column span="6">
							<h:outputText
								value="#{rutasBacking.asignacionManager.model.nombreMonitor}" />
						</b:column>
					</b:row>
					<b:row>
						<b:column offset="2" span="2">Capacidad Max</b:column>
						<b:column span="6">
							<h:outputText
								value="#{rutasBacking.asignacionManager.model.ruta.capacidadMaxima}" />
						</b:column>
					</b:row>
					<b:row>
						<h:panelGroup id="inscritosGroup">
							<b:column offset="2" span="2">Inscritos</b:column>
							<b:column span="6">
								<h:outputText
									value="#{rutasBacking.asignacionManager.inscritos.size()}" />
							</b:column>
						</h:panelGroup>
					</b:row>
					<b:row>
						<b:column>&nbsp;</b:column>
					</b:row>

					<b:selectOneMenu id="niveles"
						value="#{rutasBacking.asignacionManager.nivelId}"
						label="Nivel académico" placeholder="Nivel académico"
						select2="true" label-medium-screen="4" medium-screen="8"
						ajax="true"
						onchange="ajax:rutasBacking.asignacionManager.onChangeNivelAcademico()"
						update=" programas grados estudiantesGroup " process="@this">
						<f:selectItem noSelectionOption="true" itemLabel="--" />
						<f:selectItems value="#{rutasBacking.asignacionManager.niveles}"
							var="nivel" itemValue="#{nivel.nivelEducativoId}"
							itemLabel="#{nivel.descripcion}" />
					</b:selectOneMenu>
					<b:selectOneMenu id="programas"
						value="#{rutasBacking.asignacionManager.programaId}"
						label="Programa académico" placeholder="Programa académico"
						select2="true" label-medium-screen="4" medium-screen="8"
						ajax="true"
						onchange="ajax:rutasBacking.asignacionManager.onChangePrograma()"
						update=" grados estudiantesGroup " process="@this">
						<f:selectItem noSelectionOption="true" itemLabel="--" />
						<f:selectItems value="#{rutasBacking.asignacionManager.programas}" />
					</b:selectOneMenu>
					<b:selectOneMenu id="grados"
						value="#{rutasBacking.asignacionManager.gradoId}" label="Grado"
						placeholder="Grado" select2="true" label-medium-screen="4"
						medium-screen="8" ajax="true"
						onchange="ajax:rutasBacking.asignacionManager.onChangeGrado()"
						update=" estudiantesGroup " process="@this">
						<f:selectItem noSelectionOption="true" itemLabel="--" />
						<f:selectItems value="#{rutasBacking.asignacionManager.grados}" />
					</b:selectOneMenu>

					<h:panelGroup id="estudiantesGroup">
					</h:panelGroup>

					<f:facet name="footer">
						<b:commandButton value="Actualizar" icon="disk" ajax="true"
							action="#{rutasBacking.confirmAssignment}"
							update=" @form :listForm msgs" process="@form" look="primary" />

						<b:commandButton value="Cancelar" ajax="true"
							action="#{rutasBacking.cancel}" update=" @form :listForm "
							process="@this" />
					</f:facet>
				</b:panel>

			</h:panelGroup>
		</b:form>
	</b:container>
</h:body>
</html>