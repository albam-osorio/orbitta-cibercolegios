<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
</h:head>
<h:body>
	<ui:composition xmlns="http://www.w3.org/1999/xhtml"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:h="http://xmlns.jcp.org/jsf/html"
		xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
		xmlns:p="http://primefaces.org/ui">

		<p:outputPanel id="panelBatch">
			<p:outputPanel rendered="#{not usuariosController.manual}">
				<div class="ui-g">
					<div class="ui-g-2"></div>
					<div class="ui-g-8">
						<h:form>
							<p:blockUI block="entirePage" widgetVar="buiBatch" />
							<div class="ui-g">
								<div class="ui-g-12">
									<p:messages id="messagesBatch" showDetail="true" />
								</div>
							</div>
							<div class="ui-g">
								<div class="ui-g-4" style="text-align: right;">
									<div style="padding-top: 10px">
										<h:outputText value="CARGUE MASIVO" />
										<span class="w3-badge"> <a
											onclick="PF('helpDialog').show();" href="#"
											style="color: white;">i</a>
										</span>
									</div>
								</div>
								<div class="ui-g-8">
									<p:fileUpload id="fileUpload"
										fileUploadListener="#{usuariosController.fileUploadListener}"
										required="true" mode="advanced" multiple="false"
										skinSimple="true" auto="true"
										update="messagesBatch panelBatchCommands panelBatchErrors panelSeparator panelManual panelFooter"
										allowTypes="/(\.|\/)(xls|xlsx|pdf)$/i"
										label="Seleccionar archivo" onstart="PF('buiBatch').show()"
										oncomplete="PF('buiBatch').hide()"
										onerror="PF('buiBatch').hide()" />
								</div>
							</div>
							<div class="ui-g">
								<div class="ui-g-4"></div>
								<div class="ui-g-8">
									<p:outputPanel id="panelBatchCommands">
										<p:commandButton value="APROBAR" ajax="true"
											action="#{usuariosController.saveBatch}"
											rendered="#{usuariosController.batchManager.success}"
											update="entirePage" onstart="PF('buiBatch').show()"
											oncomplete="PF('buiBatch').hide()"
											onerror="PF('buiBatch').hide()" />
									</p:outputPanel>
								</div>
							</div>
							<div class="ui-g">
								<div class="ui-g-12">
									<p:outputPanel id="panelBatchErrors">
										<p:outputPanel
											rendered="#{usuariosController.batchManager.failure}">
											<div class="error-title-container">
												<div class="error-title">ERRORES EN EL ARCHIVO PLANO</div>
											</div>
											<div class="error-text">El archivo cargado contiene
												errores, por favor revise los registros mencionados a
												continuación y haga los ajustes pertinentes en su archivo
												plano para volver a cargarlo en su totalidad.</div>
											<p:dataTable id="listTable" var="e"
												value="#{usuariosController.batchManager.errors}"
												reflow="true" rows="5" paginator="true">
												<p:column headerText="Registro" sortable="true"
													style="text-align: right">
													<h:outputText value="#{e}" />
												</p:column>
												<p:column headerText="Documento de identidad"
													sortable="true" style="text-align: right">
													<h:outputText value="#{e.numeroIdentificacion}" />
												</p:column>
												<p:column headerText="Error" sortable="true">
													<h:outputText value="#{e.error}" />
												</p:column>
											</p:dataTable>
											<div class="error-text">
												Si lo desea puede descargar <b> <p:commandLink
														value="aquí" ajax="false">
														<p:fileDownload
															value="#{usuariosController.batchManager.streamedContent}" />
													</p:commandLink></b> el archivo que había cargado previamente y así corregir
												los errores de manera rapida.
											</div>
										</p:outputPanel>
									</p:outputPanel>
								</div>
							</div>
						</h:form>
					</div>
				</div>
			</p:outputPanel>
		</p:outputPanel>
	</ui:composition>
</h:body>
</html>